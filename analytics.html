<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impact Analytics | UrbanStake</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <i class="fas fa-city"></i>
                <span>UrbanStake</span>
            </a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="marketplace.html" class="nav-link">Marketplace</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="analytics.html" class="nav-link active">Analytics</a>
                <button class="btn btn-outline" id="connectWallet">Connect Wallet</button>
                <div class="user-menu">
                    <span class="user-avatar">U</span>
                    <span class="user-name">User123</span>
                </div>
            </div>
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Analytics Header -->
    <section class="section analytics-header">
        <div class="container">
            <div class="analytics-header-content">
                <h1>Impact Analytics</h1>
                <p>Track the collective impact of UrbanStake projects. See real-time metrics on environmental and social outcomes.</p>
                <div class="time-filter">
                    <button class="time-btn active" data-period="all">All Time</button>
                    <button class="time-btn" data-period="year">Past Year</button>
                    <button class="time-btn" data-period="quarter">Past Quarter</button>
                    <button class="time-btn" data-period="month">Past Month</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Key Metrics -->
    <section class="section">
        <div class="container">
            <div class="analytics-metrics" id="analyticsMetrics">
                <div class="analytics-metric">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <h3>CO₂ Reduction</h3>
                    </div>
                    <div class="metric-value">24,700 <span class="metric-unit">tons</span></div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> 12% vs last quarter
                    </div>
                    <div class="metric-description">Equivalent to 5,370 cars off the road</div>
                </div>
                <div class="analytics-metric">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Clean Energy</h3>
                    </div>
                    <div class="metric-value">18.4 <span class="metric-unit">GWh</span></div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> 18% vs last quarter
                    </div>
                    <div class="metric-description">Powering 20,440 homes annually</div>
                </div>
                <div class="analytics-metric">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h3>Jobs Created</h3>
                    </div>
                    <div class="metric-value">420</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> 8% vs last quarter
                    </div>
                    <div class="metric-description">Local employment opportunities</div>
                </div>
                <div class="analytics-metric">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3>Households Benefited</h3>
                    </div>
                    <div class="metric-value">3,150</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> 15% vs last quarter
                    </div>
                    <div class="metric-description">Improved living conditions</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="section bg-light">
        <div class="container">
            <div class="analytics-charts">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>CO₂ Reduction Over Time</h3>
                        <select class="chart-select" id="co2ChartType">
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                        </select>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="co2Chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Impact by Project Category</h3>
                        <select class="chart-select" id="categoryChartType">
                            <option value="doughnut">Doughnut Chart</option>
                            <option value="pie">Pie Chart</option>
                            <option value="bar">Bar Chart</option>
                        </select>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Impact Comparison -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">Project Impact Comparison</h2>
            <p class="section-subtitle">Compare the impact metrics across different project categories</p>
            
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Project Category</th>
                            <th>CO₂ Reduction (tons/year)</th>
                            <th>Energy Generated (MWh/year)</th>
                            <th>Jobs Created</th>
                            <th>Households Benefited</th>
                            <th>Avg. Investment</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTable">
                        <!-- Data will be loaded by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Geographic Impact -->
    <section class="section bg-light">
        <div class="container">
            <h2 class="section-title">Geographic Impact Distribution</h2>
            <p class="section-subtitle">See where UrbanStake projects are making a difference</p>
            
            <div class="geographic-impact">
                <div class="map-placeholder">
                    <div class="map-visualization">
                        <!-- Simple CSS-based map visualization -->
                        <div class="map-region" style="top: 30%; left: 20%;" data-region="northeast">
                            <div class="map-marker">NE</div>
                            <div class="map-tooltip">Northeast: 45 projects</div>
                        </div>
                        <div class="map-region" style="top: 50%; left: 30%;" data-region="midwest">
                            <div class="map-marker">MW</div>
                            <div class="map-tooltip">Midwest: 32 projects</div>
                        </div>
                        <div class="map-region" style="top: 60%; left: 45%;" data-region="south">
                            <div class="map-marker">S</div>
                            <div class="map-tooltip">South: 28 projects</div>
                        </div>
                        <div class="map-region" style="top: 30%; left: 10%;" data-region="west">
                            <div class="map-marker">W</div>
                            <div class="map-tooltip">West: 38 projects</div>
                        </div>
                    </div>
                </div>
                
                <div class="region-stats">
                    <h3>Impact by Region</h3>
                    <div class="region-stat">
                        <div class="region-name">Northeast</div>
                        <div class="region-data">
                            <span>45 Projects</span>
                            <span>8,240 tons CO₂ reduced</span>
                        </div>
                    </div>
                    <div class="region-stat">
                        <div class="region-name">Midwest</div>
                        <div class="region-data">
                            <span>32 Projects</span>
                            <span>6,150 tons CO₂ reduced</span>
                        </div>
                    </div>
                    <div class="region-stat">
                        <div class="region-name">South</div>
                        <div class="region-data">
                            <span>28 Projects</span>
                            <span>5,420 tons CO₂ reduced</span>
                        </div>
                    </div>
                    <div class="region-stat">
                        <div class="region-name">West</div>
                        <div class="region-data">
                            <span>38 Projects</span>
                            <span>7,890 tons CO₂ reduced</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Data Export -->
    <section class="section">
        <div class="container">
            <div class="data-export">
                <div class="export-content">
                    <h3>Export Impact Data</h3>
                    <p>Download comprehensive impact reports for your records or reporting needs.</p>
                </div>
                <div class="export-actions">
                    <button class="btn btn-outline" id="exportCSV">
                        <i class="fas fa-file-csv"></i> Export as CSV
                    </button>
                    <button class="btn btn-outline" id="exportPDF">
                        <i class="fas fa-file-pdf"></i> Export as PDF
                    </button>
                    <button class="btn btn-primary" id="generateReport">
                        <i class="fas fa-chart-bar"></i> Generate Custom Report
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <i class="fas fa-city"></i>
                        <span>UrbanStake</span>
                    </a>
                    <p>Democratizing urban development through tokenized micro-project investments.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-discord"></i></a>
                        <a href="#"><i class="fab fa-telegram"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Platform</h4>
                        <a href="marketplace.html">Marketplace</a>
                        <a href="dashboard.html">Dashboard</a>
                        <a href="analytics.html">Analytics</a>
                        <a href="#">How It Works</a>
                    </div>
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <a href="#">Documentation</a>
                        <a href="#">Blog</a>
                        <a href="#">FAQ</a>
                        <a href="#">Support</a>
                    </div>
                    <div class="footer-column">
                        <h4>Legal</h4>
                        <a href="#">Terms of Service</a>
                        <a href="#">Privacy Policy</a>
                        <a href="#">Risk Disclosure</a>
                        <a href="#">Token Agreement</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 UrbanStake. All rights reserved. This is a demo project for hackathon presentation.</p>
                <p class="disclaimer">UrbanStake is a demonstration platform. Investments shown are simulated and for presentation purposes only.</p>
            </div>
        </div>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>
    <script>
        // Initialize the analytics page
        document.addEventListener('DOMContentLoaded', function() {
            // Setup wallet connection
            document.getElementById('connectWallet').addEventListener('click', function() {
                this.textContent = 'Wallet Connected';
                this.classList.add('connected');
                showNotification('Wallet connected successfully!', 'success');
            });
            
            // Mobile menu toggle
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.querySelector('.nav-links').classList.toggle('active');
            });
            
            // Time filter buttons
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateCharts(this.getAttribute('data-period'));
                });
            });
            
            // Chart type selectors
            document.getElementById('co2ChartType').addEventListener('change', function() {
                updateChartType('co2', this.value);
            });
            
            document.getElementById('categoryChartType').addEventListener('change', function() {
                updateChartType('category', this.value);
            });
            
            // Export buttons
            document.getElementById('exportCSV').addEventListener('click', function() {
                showNotification('CSV export started. This would generate a full data export in a live implementation.', 'info');
            });
            
            document.getElementById('exportPDF').addEventListener('click', function() {
                showNotification('PDF report generation started.', 'info');
            });
            
            document.getElementById('generateReport').addEventListener('click', function() {
                showNotification('Custom report generation would open a report builder in a live implementation.', 'info');
            });
            
            // Map region hover effects
            document.querySelectorAll('.map-region').forEach(region => {
                region.addEventListener('mouseenter', function() {
                    const tooltip = this.querySelector('.map-tooltip');
                    tooltip.style.opacity = '1';
                    tooltip.style.visibility = 'visible';
                });
                
                region.addEventListener('mouseleave', function() {
                    const tooltip = this.querySelector('.map-tooltip');
                    tooltip.style.opacity = '0';
                    tooltip.style.visibility = 'hidden';
                });
            });
            
            // Load comparison table
            loadComparisonTable();
            
            // Initialize charts
            initializeCharts();
        });
        
        function loadComparisonTable() {
            const tableBody = document.getElementById('comparisonTable');
            if (!tableBody) return;
            
            // Group projects by category and calculate averages
            const categories = {};
            
            window.urbanStakeData.projects.forEach(project => {
                if (!categories[project.category]) {
                    categories[project.category] = {
                        count: 0,
                        co2Total: 0,
                        energyTotal: 0,
                        jobsTotal: 0,
                        householdsTotal: 0,
                        investmentTotal: 0
                    };
                }
                
                categories[project.category].count++;
                categories[project.category].co2Total += project.impact.co2Reduction;
                categories[project.category].energyTotal += (project.impact.energySaved || 1250);
                categories[project.category].jobsTotal += project.impact.jobsCreated;
                categories[project.category].householdsTotal += (project.impact.householdsBenefited || 180);
                categories[project.category].investmentTotal += project.totalValue;
            });
            
            // Create table rows
            tableBody.innerHTML = '';
            
            Object.keys(categories).forEach(category => {
                const data = categories[category];
                const avgCO2 = (data.co2Total / data.count).toFixed(0);
                const avgEnergy = (data.energyTotal / data.count).toFixed(0);
                const avgJobs = (data.jobsTotal / data.count).toFixed(1);
                const avgHouseholds = (data.householdsTotal / data.count).toFixed(0);
                const avgInvestment = `$${(data.investmentTotal / data.count).toLocaleString()}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="category-badge">${category}</span></td>
                    <td>${avgCO2}</td>
                    <td>${avgEnergy}</td>
                    <td>${avgJobs}</td>
                    <td>${avgHouseholds}</td>
                    <td>${avgInvestment}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function initializeCharts() {
            // CO2 Reduction Chart
            const co2Ctx = document.getElementById('co2Chart').getContext('2d');
            window.co2Chart = new Chart(co2Ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'CO₂ Reduction (tons)',
                        data: [1200, 1900, 1500, 2500, 2200, 3000, 2800, 3200, 3000, 3500, 3800, 4200],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tons of CO₂'
                            }
                        }
                    }
                }
            });
            
            // Category Impact Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            window.categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Solar Energy', 'Urban Gardens', 'EV Infrastructure', 'Waste Management', 'Water Conservation', 'Affordable Housing'],
                    datasets: [{
                        data: [35, 20, 15, 12, 10, 8],
                        backgroundColor: [
                            '#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        function updateCharts(period) {
            // In a real implementation, this would fetch new data based on the time period
            showNotification(`Updated charts for ${period} period`, 'info');
        }
        
        function updateChartType(chartName, type) {
            if (chartName === 'co2' && window.co2Chart) {
                window.co2Chart.config.type = type;
                window.co2Chart.update();
            } else if (chartName === 'category' && window.categoryChart) {
                window.categoryChart.config.type = type;
                window.categoryChart.update();
            }
        }
        
        function showNotification(message, type) {
            // Same notification function as before
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button class="notification-close"><i class="fas fa-times"></i></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
            
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            });
        }
    </script>
</body>
</html>
